{
    "info": {
        "_postman_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
        "name": "WorkFitAI - Auth Service",
        "description": "# Auth Service API Collection\n\nThis collection contains all endpoints for the WorkFitAI Authentication Service.\n\n## Overview\n- **Base URL**: `{{base_url}}`\n- **Authentication**: JWT Bearer Token (opaque token via API Gateway)\n- **Roles**: ADMIN, HR, CANDIDATE\n\n## Environment Variables Required\n- `base_url`: API Gateway URL (default: http://localhost:9085)\n- `access_token`: Current access token\n- `refresh_token`: Current refresh token\n- Role-specific credentials (adminEmail, hrEmail, candidateEmail, etc.)\n\n## Quick Start\n1. Run \"Register\" or \"Login\" request for desired role\n2. Access token is automatically saved to environment\n3. Use protected endpoints with auto-injected Bearer token\n\n## Token Flow\n1. Clients send opaque tokens to API Gateway\n2. Gateway converts opaque â†’ JWT internally\n3. Refresh token stored in httpOnly cookie",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "Public Endpoints",
            "item": [
                {
                    "name": "Health Check",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/auth",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth"
                            ]
                        },
                        "description": "Check if the auth service is running and healthy."
                    },
                    "response": []
                },
                {
                    "name": "Get Public Key",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/auth/api/v1/keys/public",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "api",
                                "v1",
                                "keys",
                                "public"
                            ]
                        },
                        "description": "Retrieve the RSA public key used for JWT verification. Used by other services to validate tokens."
                    },
                    "response": []
                }
            ],
            "description": "Public endpoints that don't require authentication."
        },
        {
            "name": "Candidate Authentication",
            "item": [
                {
                    "name": "Register Candidate",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    const jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.accessToken) {",
                                    "        pm.environment.set('access_token', jsonData.data.accessToken);",
                                    "        pm.environment.set('candidateAccessToken', jsonData.data.accessToken);",
                                    "        console.log('Candidate access token saved');",
                                    "    }",
                                    "    ",
                                    "    // Extract refresh token from Set-Cookie header",
                                    "    const cookies = pm.response.headers.get('Set-Cookie');",
                                    "    if (cookies) {",
                                    "        const match = cookies.match(/refresh_token=([^;]+)/);",
                                    "        if (match) {",
                                    "            pm.environment.set('refresh_token', match[1]);",
                                    "            pm.environment.set('candidateRefreshToken', match[1]);",
                                    "            console.log('Candidate refresh token saved');",
                                    "        }",
                                    "    }",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has access token', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('accessToken');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}",
                                "description": "Optional device identifier for session management"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"username\": \"{{candidateUsername}}\",\n    \"email\": \"{{candidateEmail}}\",\n    \"password\": \"{{candidatePassword}}\",\n    \"fullName\": \"{{candidateFullName}}\",\n    \"phoneNumber\": \"{{candidatePhone}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/register",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "register"
                            ]
                        },
                        "description": "Register a new candidate account. New users are assigned the CANDIDATE role by default.\n\n**Request Body:**\n- `username`: Unique username (required)\n- `email`: Valid email address (required)\n- `password`: 8-128 characters (required)\n- `fullName`: 3-255 characters (required)\n- `phoneNumber`: 10 digits or +84 format (required)"
                    },
                    "response": []
                },
                {
                    "name": "Login Candidate",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    const jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.accessToken) {",
                                    "        pm.environment.set('access_token', jsonData.data.accessToken);",
                                    "        pm.environment.set('candidateAccessToken', jsonData.data.accessToken);",
                                    "        console.log('Candidate access token saved');",
                                    "    }",
                                    "    ",
                                    "    // Extract refresh token from Set-Cookie header",
                                    "    const cookies = pm.response.headers.get('Set-Cookie');",
                                    "    if (cookies) {",
                                    "        const match = cookies.match(/refresh_token=([^;]+)/);",
                                    "        if (match) {",
                                    "            pm.environment.set('refresh_token', match[1]);",
                                    "            pm.environment.set('candidateRefreshToken', match[1]);",
                                    "            console.log('Candidate refresh token saved');",
                                    "        }",
                                    "    }",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has access token', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('accessToken');",
                                    "});",
                                    "",
                                    "pm.test('Response has user info', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('username');",
                                    "    pm.expect(jsonData.data).to.have.property('roles');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}",
                                "description": "Optional device identifier for session management"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"usernameOrEmail\": \"{{candidateEmail}}\",\n    \"password\": \"{{candidatePassword}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "login"
                            ]
                        },
                        "description": "Authenticate a candidate user.\n\n**Request Body:**\n- `usernameOrEmail`: Username or email address\n- `password`: User password (8-64 characters)"
                    },
                    "response": []
                },
                {
                    "name": "Logout Candidate",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.environment.unset('candidateAccessToken');",
                                    "    pm.environment.unset('candidateRefreshToken');",
                                    "    console.log('Candidate tokens cleared');",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "// Use candidate token for this request",
                                    "pm.environment.set('access_token', pm.environment.get('candidateAccessToken'));"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{candidateAccessToken}}",
                                "description": "Bearer token for authentication"
                            },
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}",
                                "description": "Optional device identifier"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/logout",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "logout"
                            ]
                        },
                        "description": "Logout the current candidate user. Invalidates the refresh token and clears the cookie."
                    },
                    "response": []
                },
                {
                    "name": "Refresh Candidate Token",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    const jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.accessToken) {",
                                    "        pm.environment.set('access_token', jsonData.data.accessToken);",
                                    "        pm.environment.set('candidateAccessToken', jsonData.data.accessToken);",
                                    "        console.log('Candidate access token refreshed');",
                                    "    }",
                                    "    ",
                                    "    // Extract new refresh token from Set-Cookie header (rotation)",
                                    "    const cookies = pm.response.headers.get('Set-Cookie');",
                                    "    if (cookies) {",
                                    "        const match = cookies.match(/refresh_token=([^;]+)/);",
                                    "        if (match) {",
                                    "            pm.environment.set('refresh_token', match[1]);",
                                    "            pm.environment.set('candidateRefreshToken', match[1]);",
                                    "            console.log('Candidate refresh token rotated');",
                                    "        }",
                                    "    }",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}",
                                "description": "Optional device identifier"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/refresh",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "refresh"
                            ]
                        },
                        "description": "Refresh the access token using the refresh token cookie. Implements token rotation for security."
                    },
                    "response": []
                }
            ],
            "description": "Authentication endpoints for Candidate users."
        },
        {
            "name": "HR Authentication",
            "item": [
                {
                    "name": "Register HR",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    const jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.accessToken) {",
                                    "        pm.environment.set('access_token', jsonData.data.accessToken);",
                                    "        pm.environment.set('hrAccessToken', jsonData.data.accessToken);",
                                    "        console.log('HR access token saved');",
                                    "    }",
                                    "    ",
                                    "    const cookies = pm.response.headers.get('Set-Cookie');",
                                    "    if (cookies) {",
                                    "        const match = cookies.match(/refresh_token=([^;]+)/);",
                                    "        if (match) {",
                                    "            pm.environment.set('refresh_token', match[1]);",
                                    "            pm.environment.set('hrRefreshToken', match[1]);",
                                    "            console.log('HR refresh token saved');",
                                    "        }",
                                    "    }",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has access token', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('accessToken');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"username\": \"{{hrUsername}}\",\n    \"email\": \"{{hrEmail}}\",\n    \"password\": \"{{hrPassword}}\",\n    \"fullName\": \"{{hrFullName}}\",\n    \"phoneNumber\": \"{{hrPhone}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/register",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "register"
                            ]
                        },
                        "description": "Register a new HR account. Note: HR role must be granted by an admin after registration."
                    },
                    "response": []
                },
                {
                    "name": "Login HR",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    const jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.accessToken) {",
                                    "        pm.environment.set('access_token', jsonData.data.accessToken);",
                                    "        pm.environment.set('hrAccessToken', jsonData.data.accessToken);",
                                    "        console.log('HR access token saved');",
                                    "    }",
                                    "    ",
                                    "    const cookies = pm.response.headers.get('Set-Cookie');",
                                    "    if (cookies) {",
                                    "        const match = cookies.match(/refresh_token=([^;]+)/);",
                                    "        if (match) {",
                                    "            pm.environment.set('refresh_token', match[1]);",
                                    "            pm.environment.set('hrRefreshToken', match[1]);",
                                    "            console.log('HR refresh token saved');",
                                    "        }",
                                    "    }",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has access token', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('accessToken');",
                                    "});",
                                    "",
                                    "pm.test('User has HR role', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data.roles).to.include('HR');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"usernameOrEmail\": \"{{hrEmail}}\",\n    \"password\": \"{{hrPassword}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "login"
                            ]
                        },
                        "description": "Authenticate an HR user."
                    },
                    "response": []
                },
                {
                    "name": "Logout HR",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.environment.unset('hrAccessToken');",
                                    "    pm.environment.unset('hrRefreshToken');",
                                    "    console.log('HR tokens cleared');",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{hrAccessToken}}",
                                "description": "Bearer token for authentication"
                            },
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/logout",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "logout"
                            ]
                        },
                        "description": "Logout the current HR user."
                    },
                    "response": []
                },
                {
                    "name": "Refresh HR Token",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    const jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.accessToken) {",
                                    "        pm.environment.set('access_token', jsonData.data.accessToken);",
                                    "        pm.environment.set('hrAccessToken', jsonData.data.accessToken);",
                                    "        console.log('HR access token refreshed');",
                                    "    }",
                                    "    ",
                                    "    const cookies = pm.response.headers.get('Set-Cookie');",
                                    "    if (cookies) {",
                                    "        const match = cookies.match(/refresh_token=([^;]+)/);",
                                    "        if (match) {",
                                    "            pm.environment.set('refresh_token', match[1]);",
                                    "            pm.environment.set('hrRefreshToken', match[1]);",
                                    "            console.log('HR refresh token rotated');",
                                    "        }",
                                    "    }",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/refresh",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "refresh"
                            ]
                        },
                        "description": "Refresh the HR access token."
                    },
                    "response": []
                }
            ],
            "description": "Authentication endpoints for HR users."
        },
        {
            "name": "Admin Authentication",
            "item": [
                {
                    "name": "Register Admin",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    const jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.accessToken) {",
                                    "        pm.environment.set('access_token', jsonData.data.accessToken);",
                                    "        pm.environment.set('adminAccessToken', jsonData.data.accessToken);",
                                    "        console.log('Admin access token saved');",
                                    "    }",
                                    "    ",
                                    "    const cookies = pm.response.headers.get('Set-Cookie');",
                                    "    if (cookies) {",
                                    "        const match = cookies.match(/refresh_token=([^;]+)/);",
                                    "        if (match) {",
                                    "            pm.environment.set('refresh_token', match[1]);",
                                    "            pm.environment.set('adminRefreshToken', match[1]);",
                                    "            console.log('Admin refresh token saved');",
                                    "        }",
                                    "    }",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has access token', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('accessToken');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"username\": \"{{adminUsername}}\",\n    \"email\": \"{{adminEmail}}\",\n    \"password\": \"{{adminPassword}}\",\n    \"fullName\": \"{{adminFullName}}\",\n    \"phoneNumber\": \"{{adminPhone}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/register",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "register"
                            ]
                        },
                        "description": "Register a new admin account. Note: Admin role must be granted by an existing admin or via database seeding."
                    },
                    "response": []
                },
                {
                    "name": "Login Admin",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    const jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.accessToken) {",
                                    "        pm.environment.set('access_token', jsonData.data.accessToken);",
                                    "        pm.environment.set('adminAccessToken', jsonData.data.accessToken);",
                                    "        console.log('Admin access token saved');",
                                    "    }",
                                    "    ",
                                    "    const cookies = pm.response.headers.get('Set-Cookie');",
                                    "    if (cookies) {",
                                    "        const match = cookies.match(/refresh_token=([^;]+)/);",
                                    "        if (match) {",
                                    "            pm.environment.set('refresh_token', match[1]);",
                                    "            pm.environment.set('adminRefreshToken', match[1]);",
                                    "            console.log('Admin refresh token saved');",
                                    "        }",
                                    "    }",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has access token', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('accessToken');",
                                    "});",
                                    "",
                                    "pm.test('User has ADMIN role', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data.roles).to.include('ADMIN');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"usernameOrEmail\": \"{{adminEmail}}\",\n    \"password\": \"{{adminPassword}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "login"
                            ]
                        },
                        "description": "Authenticate an admin user."
                    },
                    "response": []
                },
                {
                    "name": "Logout Admin",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.environment.unset('adminAccessToken');",
                                    "    pm.environment.unset('adminRefreshToken');",
                                    "    console.log('Admin tokens cleared');",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminAccessToken}}",
                                "description": "Bearer token for authentication"
                            },
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/logout",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "logout"
                            ]
                        },
                        "description": "Logout the current admin user."
                    },
                    "response": []
                },
                {
                    "name": "Refresh Admin Token",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    const jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.accessToken) {",
                                    "        pm.environment.set('access_token', jsonData.data.accessToken);",
                                    "        pm.environment.set('adminAccessToken', jsonData.data.accessToken);",
                                    "        console.log('Admin access token refreshed');",
                                    "    }",
                                    "    ",
                                    "    const cookies = pm.response.headers.get('Set-Cookie');",
                                    "    if (cookies) {",
                                    "        const match = cookies.match(/refresh_token=([^;]+)/);",
                                    "        if (match) {",
                                    "            pm.environment.set('refresh_token', match[1]);",
                                    "            pm.environment.set('adminRefreshToken', match[1]);",
                                    "            console.log('Admin refresh token rotated');",
                                    "        }",
                                    "    }",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "X-Device-Id",
                                "value": "{{deviceId}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/refresh",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "refresh"
                            ]
                        },
                        "description": "Refresh the admin access token."
                    },
                    "response": []
                }
            ],
            "description": "Authentication endpoints for Admin users."
        },
        {
            "name": "Admin - Role Management",
            "item": [
                {
                    "name": "List All Roles",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has roles array', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.be.an('array');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminAccessToken}}",
                                "description": "Bearer token for authentication"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/roles",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "roles"
                            ]
                        },
                        "description": "Get all available roles in the system.\n\n**Required Permission:** `role:read`\n**Required Role:** `ADMIN`"
                    },
                    "response": []
                },
                {
                    "name": "Create Role",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Role created successfully', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('name');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminAccessToken}}",
                                "description": "Bearer token for authentication"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"{{newRoleName}}\",\n    \"description\": \"{{newRoleDescription}}\",\n    \"permissions\": []\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/roles",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "roles"
                            ]
                        },
                        "description": "Create a new role.\n\n**Required Permission:** `role:create`\n**Required Role:** `ADMIN`\n\n**Request Body:**\n- `name`: Role name (max 64 chars, required)\n- `description`: Role description (max 255 chars, optional)\n- `permissions`: Array of permission names (optional)"
                    },
                    "response": []
                },
                {
                    "name": "Add Permission to Role",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Permission added successfully', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.success).to.be.true;",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminAccessToken}}",
                                "description": "Bearer token for authentication"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"permission\": \"{{permissionName}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/roles/{{roleName}}/permissions",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "roles",
                                "{{roleName}}",
                                "permissions"
                            ]
                        },
                        "description": "Add a permission to an existing role.\n\n**Required Permission:** `role:update`\n**Required Role:** `ADMIN`\n\n**Path Parameters:**\n- `roleName`: Name of the role to update\n\n**Request Body:**\n- `permission`: Permission name to add"
                    },
                    "response": []
                },
                {
                    "name": "Grant Role to User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Role granted successfully', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.success).to.be.true;",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminAccessToken}}",
                                "description": "Bearer token for authentication"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/users/{{targetUsername}}/roles?role={{roleToGrant}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "users",
                                "{{targetUsername}}",
                                "roles"
                            ],
                            "query": [
                                {
                                    "key": "role",
                                    "value": "{{roleToGrant}}",
                                    "description": "Role name to grant"
                                }
                            ]
                        },
                        "description": "Grant a role to a user.\n\n**Required Permission:** `role:grant`\n**Required Role:** `ADMIN`\n\n**Path Parameters:**\n- `username`: Username of the target user\n\n**Query Parameters:**\n- `role`: Role name to grant"
                    },
                    "response": []
                },
                {
                    "name": "Revoke Role from User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Role revoked successfully', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.success).to.be.true;",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "DELETE",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminAccessToken}}",
                                "description": "Bearer token for authentication"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/users/{{targetUsername}}/roles?role={{roleToRevoke}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "users",
                                "{{targetUsername}}",
                                "roles"
                            ],
                            "query": [
                                {
                                    "key": "role",
                                    "value": "{{roleToRevoke}}",
                                    "description": "Role name to revoke"
                                }
                            ]
                        },
                        "description": "Revoke a role from a user.\n\n**Required Permission:** `role:revoke`\n**Required Role:** `ADMIN`\n\n**Path Parameters:**\n- `username`: Username of the target user\n\n**Query Parameters:**\n- `role`: Role name to revoke"
                    },
                    "response": []
                },
                {
                    "name": "Get User Roles",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has roles', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.be.an('array');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminAccessToken}}",
                                "description": "Bearer token for authentication"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/users/{{targetUsername}}/roles",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "users",
                                "{{targetUsername}}",
                                "roles"
                            ]
                        },
                        "description": "Get all roles assigned to a user.\n\n**Required Permission:** `role:read`\n**Required Role:** `ADMIN`\n\n**Path Parameters:**\n- `username`: Username to check"
                    },
                    "response": []
                }
            ],
            "description": "Role management endpoints. Requires ADMIN role."
        },
        {
            "name": "Admin - Permission Management",
            "item": [
                {
                    "name": "List All Permissions",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has permissions array', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.be.an('array');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminAccessToken}}",
                                "description": "Bearer token for authentication"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/permissions",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "permissions"
                            ]
                        },
                        "description": "Get all available permissions in the system.\n\n**Required Permission:** `perm:read`\n**Required Role:** `ADMIN`"
                    },
                    "response": []
                },
                {
                    "name": "Get Permission by Name",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has permission data', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('name');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminAccessToken}}",
                                "description": "Bearer token for authentication"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/permissions/{{permissionName}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "permissions",
                                "{{permissionName}}"
                            ]
                        },
                        "description": "Get a specific permission by name.\n\n**Required Permission:** `perm:read`\n**Required Role:** `ADMIN`\n\n**Path Parameters:**\n- `name`: Permission name (e.g., `job:create`)"
                    },
                    "response": []
                },
                {
                    "name": "Create Permission",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Permission created successfully', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('name');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminAccessToken}}",
                                "description": "Bearer token for authentication"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"{{newPermissionName}}\",\n    \"description\": \"{{newPermissionDescription}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/permissions",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "permissions"
                            ]
                        },
                        "description": "Create a new permission.\n\n**Required Permission:** `perm:create`\n**Required Role:** `ADMIN`\n\n**Request Body:**\n- `name`: Permission name in format `resource:action` (max 64 chars, required)\n- `description`: Permission description (max 255 chars, optional)\n\n**Name Format Examples:**\n- `job:create`\n- `user:read`\n- `cv:upload`"
                    },
                    "response": []
                }
            ],
            "description": "Permission management endpoints. Requires ADMIN role."
        }
    ],
    "event": [
        {
            "listen": "prerequest",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "// Global pre-request script",
                    "// Ensures device ID is set for all requests",
                    "if (!pm.environment.get('deviceId')) {",
                    "    pm.environment.set('deviceId', 'postman-' + pm.info.requestName.replace(/\\s+/g, '-').toLowerCase());",
                    "}"
                ]
            }
        },
        {
            "listen": "test",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "// Global test script",
                    "// Log response time for all requests",
                    "console.log('Response time: ' + pm.response.responseTime + 'ms');"
                ]
            }
        }
    ],
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:9085",
            "type": "default"
        }
    ]
}